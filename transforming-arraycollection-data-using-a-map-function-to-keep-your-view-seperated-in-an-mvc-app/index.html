<!DOCTYPE html>
<html class="min-h-full min-w-[250px]">
  <head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>Transforming ArrayCollection data using a map function to keep your view seperated in an MVC app</title>
    <link href="https://unpkg.com/smartphoto@1.1.0/css/smartphoto.min.css" rel="stylesheet"/>

    <link href="https://unpkg.com/flickity@2/dist/flickity.min.css" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css?family=Poppins:400,700" rel="stylesheet"/>
    <link href="/assets/css/tailwind.css" rel="stylesheet"/>
    <link href="/assets/css/native.css" rel="stylesheet"/>
    <link href="/assets/css/styles.css" rel="stylesheet"/>

    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Transforming ArrayCollection data using a map function to keep your view seperated in an MVC app | Keen Development</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Transforming ArrayCollection data using a map function to keep your view seperated in an MVC app" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Last night I was working on a project which involved me having to display large amounts of data in a Flex list.  However, this data needed to be transformed before being displayed.  Let me explain with a simplified example." />
<meta property="og:description" content="Last night I was working on a project which involved me having to display large amounts of data in a Flex list.  However, this data needed to be transformed before being displayed.  Let me explain with a simplified example." />
<meta property="og:site_name" content="Keen Development" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2010-06-03T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Transforming ArrayCollection data using a map function to keep your view seperated in an MVC app" />
<script type="application/ld+json">
{"datePublished":"2010-06-03T00:00:00+00:00","dateModified":"2010-06-03T00:00:00+00:00","description":"Last night I was working on a project which involved me having to display large amounts of data in a Flex list.  However, this data needed to be transformed before being displayed.  Let me explain with a simplified example.","url":"/transforming-arraycollection-data-using-a-map-function-to-keep-your-view-seperated-in-an-mvc-app/","mainEntityOfPage":{"@type":"WebPage","@id":"/transforming-arraycollection-data-using-a-map-function-to-keep-your-view-seperated-in-an-mvc-app/"},"@type":"BlogPosting","headline":"Transforming ArrayCollection data using a map function to keep your view seperated in an MVC app","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body class="max-w-screen-xl mx-auto bg-lightgray overscroll-y-none">
    <div class="absolute left-0 right-0 h-12 shadow-md bg-code">
  <div class="flex justify-center w-full px-6 py-3 sm:justify-between">
    <a href="/">
      <img class="hidden h-7 sm:inline" src="/assets/images/Keen_bold_neg%201.svg"/>
    </a>
    <nav class="flex items-center text-base">
  <ol class="flex gap-4">
    
      <li class="text-white">
        <a href="/">Home</a>
      </li>
    
      <li class="text-white">
        <a href="/contact">Contact</a>
      </li>
    
      <li class="text-white">
        <a href="https://www.github.com/ccapndave">Github</a>
      </li>
    
  </ol>
</nav>
  </div>
</div>

<div class="px-5 pt-20 m-auto max-w-prose">
  <header class="flex justify-between">
    <div class="text-xl font-bold tracking-wide">Transforming ArrayCollection data using a map function to keep your view seperated in an MVC app<span class="font-normal text-orange">_</span>
    </div>
  </header>

  
  <div class="flex justify-between">
    <ul class="flex flex-wrap my-2 text-xs divide-x-2 font-extralight">
      
        <li>
          <span class="text-orange  mr-1 ">ARRAYCOLLECTION</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">COLLECTION_CHANGE</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">DATABINDING</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">DATAPROVIDER</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">FILTERFUNCTION</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">FLEX</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">LISTCOLLECTIONVIEW</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">MAPFUNCTION</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">MATE</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">MVC</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">PUREMVC</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">ROBOTLEGS</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">SWIZ</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">TRANSFORM</span>
        </li>
      
        <li>
          <span class="text-orange  ml-1 ">VIEW</span>
        </li>
      
    </ul>
  </div>


  <div class="flex items-center text-sm font-normal text-darkgray whitespace-nowrap">
    Jun 03, 2010
  </div>

  <article class="my-8 prose-sm prose text-green-700 sm:prose">
  <p>Last night I was working on a project which involved me having to display large amounts of data in a Flex list.  However, this data needed to be transformed before being displayed.  Let me explain with a simplified example.</p>

<h2 id="the-problem">The problem</h2>

<p>Suppose we need to display a huge list of Result objects, where a Result object contains a *score *property (lets say it is a Number).  If we just need to display the number then we provide the <a href="http://livedocs.adobe.com/flex/3/langref/mx/collections/ArrayCollection.html">ArrayCollection</a> of Results as the <strong>dataProvider</strong> to the list and set the <strong>dataField</strong> to ‘score’ and everything is nice and easy.  Now suppose that we need to do some kind of calculation on score – for example, we need to divide it by 2 before displaying it.  Again, this is no problem; we use the <strong>labelFunction</strong> in the list and add a callback function in the MXML file that divides the score by two before returning it:</p>

<div class="language-as3 highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">private</span> <span class="kd">function</span> <span class="nx">labelFunction</span><span class="p">(</span><span class="nx">item</span><span class="o">:</span><span class="nb">Object</span><span class="p">)</span><span class="o">:</span><span class="nx">String</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span><span class="o">:</span><span class="nx">Result</span> <span class="o">=</span> <span class="nx">item</span> <span class="nx">as</span> <span class="nx">Result</span><span class="o">;</span>
  <span class="k">return</span> <span class="nx">result</span><span class="p">.</span><span class="nx">score</span> <span class="o">/</span> <span class="mi">2</span><span class="o">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This is all fine.</p>

<p>Now lets suppose that we need to transform the score in a more complicated way – imagine that we are writing some kind of multiuser application and we need to divide the score by the number of users currently logged on to the application before displaying it in the list.  At this point I should point out that I tend to use <a href="http://puremvc.org/">PureMVC</a> so I will explain this using <a href="http://puremvc.org/">PureMVC</a> terminology, but its equally applicable to all other MVC frameworks (<a href="http://mate.asfusion.com/">Mate</a>, <a href="http://swizframework.org/">Swiz</a>, <a href="http://www.robotlegs.org/">Robotlegs</a>, etc).</p>

<p>Lets assume that the number of users logged on is in our Model tier; we then have a couple of options on how to go about this:</p>

<p><strong>Inject the number of users into the view from our mediator and continue to use labelFunction.</strong></p>

<div class="language-as3 highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">public</span> <span class="kd">var</span> <span class="nx">userCount</span><span class="o">:</span><span class="nx">Number</span><span class="o">;</span>

<span class="kr">private</span> <span class="kd">function</span> <span class="nx">labelFunction</span><span class="p">(</span><span class="nx">item</span><span class="o">:</span><span class="nb">Object</span><span class="p">)</span><span class="o">:</span><span class="nx">String</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span><span class="o">:</span><span class="nx">Result</span> <span class="o">=</span> <span class="nx">item</span> <span class="nx">as</span> <span class="nx">Result</span><span class="o">;</span>
  <span class="k">return</span> <span class="nx">results</span><span class="p">.</span><span class="nx">score</span> <span class="o">/</span> <span class="nx">userCount</span><span class="o">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This is an ok solution – it doesn’t break MVC encapsulation and it works fine.  However, the drawbacks are that we need to monitor when userCount changes and each time re-inject it into the view (and tell the list to update itself).  But the main problem with this is that it gives our view knowledge of something that it shouldn’t know about.</p>

<p><strong>Extend Result to do the calculation itself</strong></p>

<p>We can add a getter to Result that does the calculation which means we can get rid of labelFunction in the view and just set dataField to the getter (e.g. <strong>dataField=”transformedScore”</strong>).  But this just moves the problem elsewhere; now the Result object will need to know the number of users; we’d either have to inject it in via a static variable, or give the Result object knowledge of the MVC framework.  This solution is in fact much worse than our first effort.</p>

<p><strong>Pre-build the ArrayCollection with transformed scores</strong></p>

<p>In this method we iterate through the Results, doing our calculation on score each time and building up a new dataprovider.  This is fine from an MVC perspective; the view gets its data fully formed in the format it requires, and since the mediator is building the list there is no problem with it querying the model tier.  However, this is a bad solution for other reasons; say that you have 5000 Result objects; the mediator will need to iterate through the entire list before passing the new collection to the view, incurring a nasty performance hit.  Furthermore we will need to rebuild this list entirely if the score or the number of logged in users change.</p>

<h2 id="the-solution">The solution</h2>

<p>Here, at last, is my solution to the problem.  Like all good solutions it is disarmingly simple :)</p>

<div class="language-as3 highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">package</span> <span class="nx">org</span><span class="p">.</span><span class="nx">davekeen</span><span class="p">.</span><span class="nx">collections</span> <span class="p">{</span>
  <span class="kr">import</span> <span class="nx">mx</span><span class="p">.</span><span class="nx">collections</span><span class="p">.</span><span class="nx">IList</span><span class="o">;</span>
  <span class="kr">import</span> <span class="nx">mx</span><span class="p">.</span><span class="nx">collections</span><span class="p">.</span><span class="nx">ListCollectionView</span><span class="o">;</span>

  <span class="kr">public</span> <span class="kr">class</span> <span class="nx">MappedListCollectionView</span> <span class="kr">extends</span> <span class="nx">ListCollectionView</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="kd">var</span> <span class="nx">mapFunction</span><span class="o">:</span><span class="nb">Function</span><span class="o">;</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">MappedListCollectionView</span><span class="p">(</span><span class="nx">list</span><span class="o">:</span><span class="nx">IList</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">super</span><span class="p">(</span><span class="nx">list</span><span class="p">)</span><span class="o">;</span>
    <span class="p">}</span>

    <span class="kr">override</span> <span class="kr">public</span> <span class="kd">function</span> <span class="nx">getItemAt</span><span class="p">(</span><span class="nx">index</span><span class="o">:</span><span class="nx">int</span><span class="p">,</span> <span class="nx">prefetch</span><span class="o">:</span><span class="nx">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">:</span><span class="nb">Object</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">mapFunction</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kr">super</span><span class="p">.</span><span class="nx">getItemAt</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">prefetch</span><span class="p">)</span><span class="o">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">mapFunction</span><span class="p">(</span><span class="kr">super</span><span class="p">.</span><span class="nx">getItemAt</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">prefetch</span><span class="p">))</span><span class="o">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>MappedListCollectionView extends the normal ListCollectionView (which is the superclass of ArrayCollection) adding a single property – mapFunction – which transforms an item of the array collection into another item.  So now we can do the following in the mediator:</p>

<div class="language-as3 highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">mappedListCollectionView</span><span class="o">:</span><span class="nx">MappedListCollectionView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MappedListCollectionView</span><span class="p">(</span><span class="nx">resultsArrayCollection</span><span class="p">)</span><span class="o">;</span>
       
<span class="nx">mappedListCollectionView</span><span class="p">.</span><span class="nx">mapFunction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="o">:</span><span class="nb">Object</span><span class="p">)</span><span class="o">:</span><span class="nx">String</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">userCount</span><span class="o">:</span><span class="nx">Number</span> <span class="o">=</span> <span class="nx">getUserCountFromModel</span><span class="p">()</span><span class="o">;</span>

  <span class="kd">var</span> <span class="nx">result</span><span class="o">:</span><span class="nx">Result</span> <span class="o">=</span> <span class="nx">item</span> <span class="nx">as</span> <span class="nx">Result</span><span class="o">;</span>
  <span class="k">return</span> <span class="nx">result</span><span class="p">.</span><span class="nx">score</span> <span class="o">/</span> <span class="nx">userCount</span><span class="o">;</span>
<span class="p">}</span>

<span class="nx">myView</span><span class="p">.</span><span class="nx">myList</span><span class="p">.</span><span class="nx">dataProvider</span> <span class="o">=</span> <span class="nx">mappedListCollectionView</span><span class="o">;</span>
</code></pre></div></div>

<p>I think this is an excellent solution – it maintains encapsulation within the view, it follows Flex standards (in that its syntax is the same as filterFunction), it will work with Flex binding and COLLECTION_CHANGE events and best of all it is high performance as mapFunction is only called for the rows that are actually on the screen.</p>

<p>One thing to bear in mind when using this solution is that Flex databinding will only be triggered when elements of the array collection itself change, so if userCount changes you will need to manually dispatch a COLLECTION_CHANGE event on the array collection.</p>

<p>Hope you find this as useful as I do!</p>

</article>
</div>

  </body>

  <script src="https://unpkg.com/smartphoto@1.1.0/js/smartphoto.min.js"></script>
  <script src="https://unpkg.com/flickity@2/dist/flickity.pkgd.min.js"></script>
</html>
