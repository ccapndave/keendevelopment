<!DOCTYPE html>
<html class="min-h-full min-w-[250px]">
  <head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>Flextrine Tutorial – CRUD in a simple Flex 4 address book: Loading the entities</title>
    <link href="https://unpkg.com/smartphoto@1.1.0/css/smartphoto.min.css" rel="stylesheet"/>

    <link href="https://unpkg.com/flickity@2/dist/flickity.min.css" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css?family=Poppins:400,700" rel="stylesheet"/>
    <link href="/assets/css/tailwind.css" rel="stylesheet"/>
    <link href="/assets/css/native.css" rel="stylesheet"/>
    <link href="/assets/css/styles.css" rel="stylesheet"/>

    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Flextrine Tutorial – CRUD in a simple Flex 4 address book: Loading the entities | Keen Development</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Flextrine Tutorial – CRUD in a simple Flex 4 address book: Loading the entities" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Introduction Setting up the server Creating the entities Creating the database schema Loading the entities Creating new entities Deleting entities Updating entities Conclusion" />
<meta property="og:description" content="Introduction Setting up the server Creating the entities Creating the database schema Loading the entities Creating new entities Deleting entities Updating entities Conclusion" />
<meta property="og:site_name" content="Keen Development" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2010-08-03T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Flextrine Tutorial – CRUD in a simple Flex 4 address book: Loading the entities" />
<script type="application/ld+json">
{"datePublished":"2010-08-03T00:00:00+00:00","dateModified":"2010-08-03T00:00:00+00:00","description":"Introduction Setting up the server Creating the entities Creating the database schema Loading the entities Creating new entities Deleting entities Updating entities Conclusion","url":"/flextrine-tutorial-crud-in-a-simple-flex-4-address-book-loading-the-entities/","mainEntityOfPage":{"@type":"WebPage","@id":"/flextrine-tutorial-crud-in-a-simple-flex-4-address-book-loading-the-entities/"},"@type":"BlogPosting","headline":"Flextrine Tutorial – CRUD in a simple Flex 4 address book: Loading the entities","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body class="max-w-screen-xl mx-auto bg-lightgray overscroll-y-none">
    <div class="absolute left-0 right-0 h-12 shadow-md bg-code">
  <div class="flex justify-center w-full px-6 py-3 sm:justify-between">
    <a href="/">
      <img class="hidden h-7 sm:inline" src="/assets/images/Keen_bold_neg%201.svg"/>
    </a>
    <nav class="flex items-center text-base">
  <ol class="flex gap-4">
    
      <li class="text-white">
        <a href="/">Home</a>
      </li>
    
      <li class="text-white">
        <a href="/contact">Contact</a>
      </li>
    
      <li class="text-white">
        <a href="https://www.github.com/ccapndave">Github</a>
      </li>
    
  </ol>
</nav>
  </div>
</div>

<div class="px-5 pt-20 m-auto max-w-prose">
  <header class="flex justify-between">
    <div class="text-xl font-bold tracking-wide">Flextrine Tutorial – CRUD in a simple Flex 4 address book: Loading the entities<span class="font-normal text-orange">_</span>
    </div>
  </header>

  
  <div class="flex justify-between">
    <ul class="flex flex-wrap my-2 text-xs divide-x-2 font-extralight">
      
        <li>
          <span class="text-orange  mr-1 ">AS3 CLASSES</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">CLASSPATH</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">ENTITY REPOSITORIES</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">ENTITYMANAGER</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">ENTITYREPOSITORY</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">FLEXTRINE</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">FLEXTRINE MANAGER</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">LOADALL</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">ORM</span>
        </li>
      
        <li>
          <span class="text-orange  ml-1 ">REMOTECLASS</span>
        </li>
      
    </ul>
  </div>


  <div class="flex items-center text-sm font-normal text-darkgray whitespace-nowrap">
    Aug 03, 2010
  </div>

  <article class="my-8 prose-sm prose text-green-700 sm:prose">
  <ul>
  <li><a href="/flextrine-tutorial-crud-in-a-simple-flex-4-address-book-introduction/">Introduction</a></li>
  <li><a href="/flextrine-tutorial-crud-in-a-simple-flex-4-address-book-setting-up-the-server/">Setting up the server</a></li>
  <li><a href="/flextrine-tutorial-crud-in-a-simple-flex-4-address-book-creating-the-entities/">Creating the entities</a></li>
  <li><a href="/flextrine-tutorial-crud-in-a-simple-flex-4-address-book-creating-the-database-schema/">Creating the database schema</a></li>
  <li><a href="/flextrine-tutorial-crud-in-a-simple-flex-4-address-book-loading-the-entities/">Loading the entities</a></li>
  <li><a href="/flextrine-tutorial-crud-in-a-simple-flex-4-address-book-creating-new-entities/">Creating new entities</a></li>
  <li><a href="/flextrine-tutorial-crud-in-a-simple-flex-4-address-book-deleting-entities/">Deleting entities</a></li>
  <li><a href="/flextrine-tutorial-crud-in-a-simple-flex-4-address-book-updating-entities/">Updating entities</a></li>
  <li><a href="/flextrine-tutorial-crud-in-a-simple-flex-4-address-book-conclusion/">Conclusion</a></li>
</ul>

<p>In FlashDevelop or Flash Builder create a new Flex 4 project and add the Flextrine client side library (in <em>flextrine/src</em> of the Flextrine download) to the classpath of your project.  Alternatively you can use the compiled <em>flextrine/bin/flextrine.swc</em>.  Now return to the Flextrine manager and click on <strong>GENERATE AS3 CLASSES</strong>.  You will be prompted to download a zip file – extract its contents into the <em>src</em> directory of your project.  You should now have AS3 versions of <em>vo.ContactGroup</em> and <em>vo.Contact</em> for use in your Flex application.</p>

<p>For reference, here are a few screenshot of what we will be working towards.  The tree on the left will show the groups and contacts, and the area on the right will have the group editor at the top and the contact editor below.  We will also have some buttons to create, delete and save contacts and groups.</p>

<p><img src="/assets/uploads/2010/08/contacts1.jpg" alt="Flextrine Contacts 1" />
<img src="/assets/uploads/2010/08/contacts2.jpg" alt="Flextrine Contacts 2" /></p>

<h3 id="create-the-mainmxml-entry-class">Create the Main.mxml entry class</h3>

<p>We will begin by creating the Main.mxml entry class for our application.  To start with we will just create the basic MXML Application with a creationComplete event listener that configures Flextrine’s central class – the <a href="http://code.google.com/p/flextrine2/wiki/EntityManager">EntityManager</a>.  For our simple application the only configuration that is required is to set the URL of <em>gateway.php</em> in the Flextrine server side component – in this case <a href="http://localhost/contacts/gateway.php">http://localhost/contacts/gateway.php</a>.</p>

<div class="language-mxml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;s:Application</span> <span class="na">xmlns:fx=</span><span class="s">"http://ns.adobe.com/mxml/2009"</span>
               <span class="na">xmlns:s=</span><span class="s">"library://ns.adobe.com/flex/spark"</span>
               <span class="na">xmlns:mx=</span><span class="s">"library://ns.adobe.com/flex/mx"</span>
               <span class="na">xmlns:local=</span><span class="s">"*"</span>
               <span class="na">creationComplete=</span><span class="s">"creationComplete()"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;fx:Script&gt;</span>
    <span class="cp">&lt;![CDATA[</span>
      <span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">davekeen</span><span class="p">.</span><span class="nx">flextrine</span><span class="p">.</span><span class="nx">orm</span><span class="p">.</span><span class="nx">Configuration</span><span class="o">;</span>
      <span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">davekeen</span><span class="p">.</span><span class="nx">flextrine</span><span class="p">.</span><span class="nx">orm</span><span class="p">.</span><span class="nx">EntityManager</span><span class="o">;</span>
           
      <span class="kr">private</span> <span class="kd">var</span> <span class="nx">em</span><span class="o">:</span><span class="nx">EntityManager</span><span class="o">;</span>
           
      <span class="cm">/**
       * Initialize the Flextrine EntityManager, set the dataprovider of the tred th      ContactGroups.
       */</span>
       <span class="kr">private</span> <span class="kd">function</span> <span class="nx">creationComplete</span><span class="p">()</span><span class="o">:</span><span class="nb">void</span> <span class="p">{</span>
         <span class="c1">// Setup the entity manager</span>
         <span class="kd">var</span> <span class="nx">configuration</span><span class="o">:</span><span class="nx">Configuration</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Configuration</span><span class="p">()</span><span class="o">;</span>
         <span class="nx">configuration</span><span class="p">.</span><span class="nx">gateway</span> <span class="o">=</span> <span class="s2">"http://localhost/contacts/gateway.php"</span><span class="o">;</span>
       
         <span class="nx">em</span> <span class="o">=</span> <span class="nx">EntityManager</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">()</span><span class="o">;</span>
         <span class="nx">em</span><span class="p">.</span><span class="nx">setConfiguration</span><span class="p">(</span><span class="nx">configuration</span><span class="p">)</span><span class="o">;</span>
       <span class="p">}</span>   
    <span class="cp">]]&gt;</span>
  <span class="nt">&lt;/fx:Script&gt;</span>
<span class="nt">&lt;/s:Application&gt;</span>
</code></pre></div></div>

<p>Now we’ll add the GUI.  We’ll add a Flex Tree on the left with id <strong>tree</strong>, along with the buttons and the layout.</p>

<div class="language-mxml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
 <span class="nt">&lt;s:Application</span> <span class="na">xmlns:fx=</span><span class="s">"http://ns.adobe.com/mxml/2009"</span>
                <span class="na">xmlns:s=</span><span class="s">"library://ns.adobe.com/flex/spark"</span>
                <span class="na">xmlns:mx=</span><span class="s">"library://ns.adobe.com/flex/mx"</span>
                <span class="na">xmlns:local=</span><span class="s">"*"</span>
                <span class="na">creationComplete=</span><span class="s">"creationComplete()"</span><span class="nt">&gt;</span>

     <span class="nt">&lt;fx:Script&gt;</span>
         <span class="cp">&lt;![CDATA[</span>
      <span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">davekeen</span><span class="p">.</span><span class="nx">flextrine</span><span class="p">.</span><span class="nx">orm</span><span class="p">.</span><span class="nx">Configuration</span><span class="o">;</span>
      <span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">davekeen</span><span class="p">.</span><span class="nx">flextrine</span><span class="p">.</span><span class="nx">orm</span><span class="p">.</span><span class="nx">EntityManager</span><span class="o">;</span>
      
      <span class="kr">private</span> <span class="kd">var</span> <span class="nx">em</span><span class="o">:</span><span class="nx">EntityManager</span><span class="o">;</span>
      
      <span class="cm">/**
       * Initialize the Flextrine EntityManager, set the dataprovider of the tree and d the ContactGroups.
       */</span>
      <span class="kr">private</span> <span class="kd">function</span> <span class="nx">creationComplete</span><span class="p">()</span><span class="o">:</span><span class="nb">void</span> <span class="p">{</span>
              <span class="c1">// Setup the entity manager</span>
              <span class="kd">var</span> <span class="nx">configuration</span><span class="o">:</span><span class="nx">Configuration</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Configuration</span><span class="p">()</span><span class="o">;</span>
              <span class="nx">configuration</span><span class="p">.</span><span class="nx">gateway</span> <span class="o">=</span> <span class="s2">"http://localhost/contacts/gateway.php"</span><span class="o">;</span>

              <span class="nx">em</span> <span class="o">=</span> <span class="nx">EntityManager</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">()</span><span class="o">;</span>
              <span class="nx">em</span><span class="p">.</span><span class="nx">setConfiguration</span><span class="p">(</span><span class="nx">configuration</span><span class="p">)</span><span class="o">;</span>
       <span class="p">}</span>

       <span class="cp">]]&gt;</span>
           <span class="nt">&lt;/fx:Script&gt;</span>
      
           <span class="nt">&lt;s:HGroup</span> <span class="na">width=</span><span class="s">"100%"</span> <span class="na">height=</span><span class="s">"100%"</span><span class="nt">&gt;</span>
               <span class="c">&lt;!-- The groups and contacts tree --&gt;</span>
               <span class="nt">&lt;s:VGroup</span> <span class="na">height=</span><span class="s">"100%"</span><span class="nt">&gt;</span>
                   <span class="nt">&lt;mx:Tree</span> <span class="na">id=</span><span class="s">"tree"</span> <span class="na">width=</span><span class="s">"100%"</span> <span class="na">height=</span><span class="s">"100%"</span> <span class="nt">/&gt;</span>
               <span class="nt">&lt;/s:VGroup&gt;</span>
      
               <span class="nt">&lt;s:VGroup</span> <span class="na">width=</span><span class="s">"100%"</span> <span class="na">height=</span><span class="s">"100%"</span><span class="nt">&gt;</span>
                   <span class="c">&lt;!-- The editors will go here --&gt;</span>
      
                   <span class="nt">&lt;mx:Spacer</span> <span class="na">height=</span><span class="s">"100%"</span> <span class="nt">/&gt;</span>
      
                   <span class="nt">&lt;mx:HRule</span> <span class="na">width=</span><span class="s">"100%"</span> <span class="nt">/&gt;</span>
      
                   <span class="c">&lt;!-- The buttons --&gt;</span>
                   <span class="nt">&lt;mx:ControlBar</span> <span class="na">width=</span><span class="s">"100%"</span> <span class="na">horizontalAlign=</span><span class="s">"center"</span><span class="nt">&gt;</span>
                       <span class="nt">&lt;s:Button</span> <span class="na">label=</span><span class="s">"New group"</span> <span class="nt">/&gt;</span>
                       <span class="nt">&lt;s:Button</span> <span class="na">label=</span><span class="s">"New contact"</span> <span class="nt">/&gt;</span>
                       <span class="nt">&lt;s:Button</span> <span class="na">label=</span><span class="s">"Delete"</span> <span class="nt">/&gt;</span>
                       <span class="nt">&lt;s:Button</span> <span class="na">label=</span><span class="s">"Save"</span> <span class="nt">/&gt;</span>
                   <span class="nt">&lt;/mx:ControlBar&gt;</span>
               <span class="nt">&lt;/s:VGroup&gt;</span>
           <span class="nt">&lt;/s:HGroup&gt;</span>
      
       <span class="nt">&lt;/s:Application&gt;</span>
</code></pre></div></div>

<h3 id="loading-the-contacts-into-the-tree">Loading the contacts into the tree</h3>

<p>Now its time to load some data into the tree.  Obviously at this point there isn’t any data to load so for the moment we’ll manually add some into the database so we have something to see.  Execute the following SQL against the *contacts *database to create some test data.  This creates two groups and three contacts, just like in the screenshots at the top of this section.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="nv">`contact`</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">,</span><span class="nv">`name`</span><span class="p">,</span><span class="nv">`telephoneNumber`</span><span class="p">,</span><span class="nv">`birthday`</span><span class="p">,</span><span class="nv">`contactGroup_id`</span><span class="p">)</span> <span class="k">VALUES</span>
  <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">'Arthur'</span><span class="p">,</span><span class="s1">'01332 823636'</span><span class="p">,</span><span class="s1">'1976-01-12'</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
  <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">'Mum'</span><span class="p">,</span><span class="s1">'07884 763623'</span><span class="p">,</span><span class="s1">'1976-01-13'</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
  <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s1">'Peter'</span><span class="p">,</span><span class="s1">'0131 827 3625'</span><span class="p">,</span><span class="s1">'1977-12-06'</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nv">`contactgroup`</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">,</span><span class="nv">`name`</span><span class="p">)</span> <span class="k">VALUES</span>
  <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">'Family'</span><span class="p">),</span>
  <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">'Friends'</span><span class="p">);</span>
</code></pre></div></div>

<p>At this point we should talk about the concept of Flextrine’s <a href="https://code.google.com/p/flextrine2/wiki/EntityRepository">entity repositories</a>.  Every entity in your application has its own EntityRepository, so for our application we have one EntityRepository for <em>ContactGroup</em> and one for <em>Contact</em>.  Entity repositories perform a number of functions:</p>

<ul>
  <li>First and foremost entity repositories provide local storage for your entities.  Each EntityRepository has an attribute called <em>entities</em> which is an <a href="https://livedocs.adobe.com/flex/3/langref/mx/collections/ArrayCollection.html">ArrayCollection</a> containing the entities currently in existence in your application.</li>
  <li>Secondly entity repositories make sure that there is only ever one instance of a particular entity in existence at any one time.</li>
  <li>Finally entity repositories watch their entities for changes and mark them for updating when they change.</li>
</ul>

<p>Add the following lines to the end of <em>creationComplete()</em> remembering to add <strong>import vo.ContactGroup</strong> to the top of the script tag.</p>

<div class="language-as3 highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">tree</span><span class="p">.</span><span class="nx">dataProvider</span> <span class="o">=</span> <span class="nx">em</span><span class="p">.</span><span class="nx">getRepository</span><span class="p">(</span><span class="nx">ContactGroup</span><span class="p">).</span><span class="nx">entities</span><span class="o">;</span>
<span class="nx">em</span><span class="p">.</span><span class="nx">getRepository</span><span class="p">(</span><span class="nx">ContactGroup</span><span class="p">).</span><span class="nx">loadAll</span><span class="p">()</span><span class="o">;</span>
</code></pre></div></div>

<p>The first line sets the <em>entities</em> of the ContactGroup EntityRepository as the dataProvider of the tree.  Obviously at this point there are no entities in the ContactGroup repository, but Flextrine is very careful to respect Flex databinding throughout its lifecycle so in fact it doesn’t matter that <em>entities</em> is currently empty.  Any Flex component bound to the <em>entities</em> will automatically update themselves when the repository changes with no extra work required.</p>

<p>The second line calls the <em>loadAll()</em> method on the ContactGroup repository.  As you would expect this loads all the ContactGroups into the ContactsGroup repository and Flex databinding will take care of updating the tree once the load is complete.  By default Flextrine runs in EAGER mode, which means that when loading entities it will follow all associations and load any linked objects, so in fact loading the ContactGroups will also load all the Contacts.  Flextrine also supports LAZY loading which won’t automatically follow associations and requires you to to explicitly request unitialized entities; see <a href="https://code.google.com/p/flextrine2/wiki/LazyLoading">Loading Associations</a> for more details.</p>

<p>If you now run the application it will look like this.</p>

<p><img src="/assets/uploads/2010/08/contacts3.jpg" alt="Flextrine Contacts 3" /></p>

<p>We can see that the two ContactGroups are loading from the database and that Flex databinding has updated the tree automatically to reflect the loaded entities.  Unfortunately the tree doesn’t realise that it should be showing contacts as children of the contact groups, so we need to explicitly tell it so by adding a <em>children</em> attribute to ContactGroup.  Flextrine allows you to add logic to your entities by seperating Flextrine specific code into an ‘EntityBase’ class, and then creating an empty main entity class which you can ammend.  The idea behind this is that if you later update your entities you can replace the EntityBase without losing any functionality you added to the main entity class.</p>

<p>Open up <em>vo/ContactGroup.as</em> and add a getter function that simply returns the <em>contacts</em>:</p>

<div class="language-as3 highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">package</span> <span class="nx">vo</span> <span class="p">{</span>
  <span class="kr">import</span> <span class="nx">mx</span><span class="p">.</span><span class="nx">collections</span><span class="p">.</span><span class="nx">ArrayCollection</span><span class="o">;</span>

  <span class="p">[</span><span class="nx">RemoteClass</span><span class="p">(</span><span class="nx">alias</span><span class="o">=</span><span class="s2">"vo/ContactGroup"</span><span class="p">)]</span>
  <span class="p">[</span><span class="nx">Entity</span><span class="p">]</span>
  <span class="kr">public</span> <span class="kr">class</span> <span class="nx">ContactGroup</span> <span class="kr">extends</span> <span class="nx">ContactGroupEntityBase</span> <span class="p">{</span>
    <span class="kr">public</span> <span class="kd">function</span> <span class="kr">get</span> <span class="nx">children</span><span class="p">()</span><span class="o">:</span><span class="nx">ArrayCollection</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">contacts</span><span class="o">;</span>
    <span class="p">}</span>    
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We also want the labels in the tree to show the <em>name</em> property of both ContactGroup and Contact so add labelField=”name” to the Tree component in Main.mxml:</p>

<div class="language-mxml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;mx:Tree</span> <span class="na">id=</span><span class="s">"tree"</span> <span class="na">width=</span><span class="s">"100%"</span> <span class="na">height=</span><span class="s">"100%"</span> <span class="na">labelField=</span><span class="s">"name"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>

<p>Lets see how we can <a href="/flextrine-tutorial-crud-in-a-simple-flex-4-address-book-creating-new-entities/">create new entities</a>.</p>

</article>
</div>

  </body>

  <script src="https://unpkg.com/smartphoto@1.1.0/js/smartphoto.min.js"></script>
  <script src="https://unpkg.com/flickity@2/dist/flickity.pkgd.min.js"></script>
</html>
