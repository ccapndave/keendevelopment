<!DOCTYPE html>
<html class="min-h-full min-w-[250px]">
  <head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>PureMVC Tutorial - Flex, PureMVC, Jabber and XIFF Part 9 - The Chat View & Mediator</title>
    <link href="https://unpkg.com/smartphoto@1.1.0/css/smartphoto.min.css" rel="stylesheet"/>

    <link href="https://unpkg.com/flickity@2/dist/flickity.min.css" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css?family=Poppins:400,700" rel="stylesheet"/>
    <link href="/assets/css/tailwind.css" rel="stylesheet"/>
    <link href="/assets/css/native.css" rel="stylesheet"/>
    <link href="/assets/css/styles.css" rel="stylesheet"/>

    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>PureMVC Tutorial - Flex, PureMVC, Jabber and XIFF Part 9 - The Chat View &amp; Mediator | Keen Development</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="PureMVC Tutorial - Flex, PureMVC, Jabber and XIFF Part 9 - The Chat View &amp; Mediator" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Introduction Part 1 - Frameworks Part 2 - Directory structure Part 3 - Application and ApplicationFacade Part 4 - Notifications, Commands &amp; Use Cases Part 5 - Model &amp; Proxy Part 6 - The Application View &amp; Mediator Part 7 - The Login View &amp; Mediator Part 8 - The Roster View &amp; Mediator Part 9 - The Chat View &amp; Mediator Conclusion, Demo &amp; Downloads" />
<meta property="og:description" content="Introduction Part 1 - Frameworks Part 2 - Directory structure Part 3 - Application and ApplicationFacade Part 4 - Notifications, Commands &amp; Use Cases Part 5 - Model &amp; Proxy Part 6 - The Application View &amp; Mediator Part 7 - The Login View &amp; Mediator Part 8 - The Roster View &amp; Mediator Part 9 - The Chat View &amp; Mediator Conclusion, Demo &amp; Downloads" />
<meta property="og:site_name" content="Keen Development" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2008-07-19T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="PureMVC Tutorial - Flex, PureMVC, Jabber and XIFF Part 9 - The Chat View &amp; Mediator" />
<script type="application/ld+json">
{"datePublished":"2008-07-19T00:00:00+00:00","dateModified":"2008-07-19T00:00:00+00:00","description":"Introduction Part 1 - Frameworks Part 2 - Directory structure Part 3 - Application and ApplicationFacade Part 4 - Notifications, Commands &amp; Use Cases Part 5 - Model &amp; Proxy Part 6 - The Application View &amp; Mediator Part 7 - The Login View &amp; Mediator Part 8 - The Roster View &amp; Mediator Part 9 - The Chat View &amp; Mediator Conclusion, Demo &amp; Downloads","url":"/puremvc-tutorial-flex-puremvc-jabber-and-xiff-3-part-9-the-chat-view-mediator/","mainEntityOfPage":{"@type":"WebPage","@id":"/puremvc-tutorial-flex-puremvc-jabber-and-xiff-3-part-9-the-chat-view-mediator/"},"@type":"BlogPosting","headline":"PureMVC Tutorial - Flex, PureMVC, Jabber and XIFF Part 9 - The Chat View &amp; Mediator","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body class="max-w-screen-xl mx-auto bg-lightgray overscroll-y-none">
    <div class="absolute left-0 right-0 h-12 shadow-md bg-code">
  <div class="flex justify-center w-full px-6 py-3 sm:justify-between">
    <a href="/">
      <img class="hidden h-7 sm:inline" src="/assets/images/Keen_bold_neg%201.svg"/>
    </a>
    <nav class="flex items-center text-base">
  <ol class="flex gap-4">
    
      <li class="text-white">
        <a href="/">Home</a>
      </li>
    
      <li class="text-white">
        <a href="/contact">Contact</a>
      </li>
    
      <li class="text-white">
        <a href="https://www.github.com/ccapndave">Github</a>
      </li>
    
  </ol>
</nav>
  </div>
</div>

<div class="px-5 pt-20 m-auto max-w-prose">
  <header class="flex justify-between">
    <div class="text-xl font-bold tracking-wide">PureMVC Tutorial - Flex, PureMVC, Jabber and XIFF Part 9 - The Chat View & Mediator<span class="font-normal text-orange">_</span>
    </div>
  </header>

  
  <div class="flex justify-between">
    <ul class="flex flex-wrap my-2 text-xs divide-x-2 font-extralight">
      
        <li>
          <span class="text-orange  mr-1 ">CHAT WINDOW</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">JABBER CHAT</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">JABBER CLIENT</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">POPUPMANAGER</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">PUREMVC</span>
        </li>
      
        <li>
          <span class="text-orange  mx-1 ">TUTORIAL</span>
        </li>
      
        <li>
          <span class="text-orange  ml-1 ">VIEW COMPONENTS</span>
        </li>
      
    </ul>
  </div>


  <div class="flex items-center text-sm font-normal text-darkgray whitespace-nowrap">
    Jul 19, 2008
  </div>

  <article class="my-8 prose-sm prose text-green-700 sm:prose">
  <ul>
  <li><a href="/puremvc-tutorial-flex-puremvc-jabber-and-xiff-3-introduction/">Introduction</a></li>
  <li><a href="/puremvc-tutorial-flex-puremvc-jabber-and-xiff-3-part-1-frameworks/">Part 1 - Frameworks</a></li>
  <li><a href="/puremvc-tutorial-flex-puremvc-jabber-and-xiff-3-part-2-directory-structure/">Part 2 - Directory structure</a></li>
  <li><a href="/puremvc-tutorial-flex-puremvc-jabber-and-xiff-3-part-3-application-and-applicationfacade/">Part 3 - Application and ApplicationFacade</a></li>
  <li><a href="/puremvc-tutorial-flex-puremvc-jabber-and-xiff-3-part-4-notifications-commands-use-cases/">Part 4 - Notifications, Commands &amp; Use Cases</a></li>
  <li><a href="/puremvc-tutorial-flex-puremvc-jabber-and-xiff-3-part-5-model-proxy/">Part 5 - Model &amp; Proxy</a></li>
  <li><a href="/puremvc-tutorial-flex-puremvc-jabber-and-xiff-3-part-6-the-application-view-mediator/">Part 6 - The Application View &amp; Mediator</a></li>
  <li><a href="/puremvc-tutorial-flex-puremvc-jabber-and-xiff-3-part-7-the-login-view-mediator/">Part 7 - The Login View &amp; Mediator</a></li>
  <li><a href="/puremvc-tutorial-flex-puremvc-jabber-and-xiff-3-part-8-the-roster-view-mediator/">Part 8 - The Roster View &amp; Mediator</a></li>
  <li><a href="/puremvc-tutorial-flex-puremvc-jabber-and-xiff-3-part-9-the-chat-view-mediator/">Part 9 - The Chat View &amp; Mediator</a></li>
  <li><a href="/puremvc-tutorial-flex-puremvc-jabber-and-xiff-3-conclusion-demo-downloads/">Conclusion, Demo &amp; Downloads</a></li>
</ul>

<p>The final mediator, and the final actor in our application.  The job of the chat view is to popup a window where you receive and send message to another user.  You should be able to open multiple chat windows at once, and each window is bound to a specific and unique JID.</p>

<p>I’m just going to present the code for this with a short explanation of anything odd rather than explicitly go through the steps.  If you have trouble understanding anything go back to the previous sections on mediators and read them through again.</p>

<p><em>ChatView.mxml</em></p>

<div class="language-mxml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;mx:TitleWindow</span> <span class="na">xmlns:mx=</span><span class="s">"http://www.adobe.com/2006/mxml"</span> <span class="na">title=</span><span class="s">""</span> <span class="na">showCloseButton=</span><span class="s">"true"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;mx:Script&gt;</span>
  <span class="cp">&lt;![CDATA[</span>
  <span class="kr">import</span> <span class="nx">mx</span><span class="p">.</span><span class="nx">formatters</span><span class="p">.</span><span class="nx">DateFormatter</span><span class="o">;</span>
  <span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">davekeen</span><span class="p">.</span><span class="nx">xiffer</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">ChatEvent</span><span class="o">;</span>
  <span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">jivesoftware</span><span class="p">.</span><span class="nx">xiff</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nx">JID</span><span class="o">;</span>
  <span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">jivesoftware</span><span class="p">.</span><span class="nx">xiff</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">Message</span><span class="o">;</span>

  <span class="kr">private</span> <span class="kd">var</span> <span class="nx">jid</span><span class="o">:</span><span class="nx">JID</span><span class="o">;</span>

  <span class="cm">/**
   * The send button was clicked so dispatch an event to the mediator
   */</span>
  <span class="kr">private</span> <span class="kd">function</span> <span class="nx">sendClick</span><span class="p">()</span><span class="o">:</span><span class="nb">void</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">inputText</span><span class="o">:</span><span class="nx">String</span> <span class="o">=</span> <span class="nx">inputTextArea</span><span class="p">.</span><span class="nx">text</span><span class="o">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">inputText</span> <span class="o">&amp;&amp;</span> <span class="nx">inputText</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">dispatchEvent</span><span class="p">(</span><span class="k">new</span> <span class="nx">ChatEvent</span><span class="p">(</span><span class="nx">ChatEvent</span><span class="p">.</span><span class="nx">SEND_MESSAGE</span><span class="p">,</span> <span class="nx">jid</span><span class="p">,</span> <span class="nx">inputText</span><span class="p">))</span><span class="o">;</span>
      <span class="nx">inputTextArea</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="s2">""</span><span class="o">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kr">public</span> <span class="kd">function</span> <span class="nx">setJID</span><span class="p">(</span><span class="nx">jid</span><span class="o">:</span><span class="nx">JID</span><span class="p">)</span><span class="o">:</span><span class="nb">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">jid</span> <span class="o">=</span> <span class="nx">jid</span><span class="o">;</span>

    <span class="nx">title</span> <span class="o">=</span> <span class="nx">jid</span><span class="p">.</span><span class="nx">toBareJID</span><span class="p">()</span><span class="o">;</span>
  <span class="p">}</span>

  <span class="kr">public</span> <span class="kd">function</span> <span class="nx">getJID</span><span class="p">()</span><span class="o">:</span><span class="nx">JID</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">jid</span><span class="o">;</span>
  <span class="p">}</span>

  <span class="cm">/**
   * Format and add a message to the chat pane
   * 
   * @param    message
   */</span>
  <span class="kr">public</span> <span class="kd">function</span> <span class="nx">addMessage</span><span class="p">(</span><span class="nx">message</span><span class="o">:</span><span class="nx">Message</span><span class="p">)</span><span class="o">:</span><span class="nb">void</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">dateFormatter</span><span class="o">:</span><span class="nx">DateFormatter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DateFormatter</span><span class="p">()</span><span class="o">;</span>
    <span class="nx">dateFormatter</span><span class="p">.</span><span class="nx">formatString</span> <span class="o">=</span> <span class="s2">"HH:NN"</span><span class="o">;</span>
    <span class="nx">chatTextArea</span><span class="p">.</span><span class="nx">text</span> <span class="o">+=</span> <span class="s2">"["</span> <span class="o">+</span> <span class="nx">dateFormatter</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="k">new</span> <span class="nx">Date</span><span class="p">())</span> <span class="o">+</span> <span class="s2">"] "</span> <span class="o">+</span> <span class="nx">message</span><span class="p">.</span><span class="nx">body</span> <span class="o">+</span> <span class="s2">"\n"</span><span class="o">;</span>
  <span class="p">}</span>

  <span class="cp">]]&gt;</span>
  <span class="nt">&lt;/mx:Script&gt;</span>
  <span class="nt">&lt;mx:VBox&gt;</span>
    <span class="nt">&lt;mx:TextArea</span> <span class="na">editable=</span><span class="s">"false"</span> <span class="na">width=</span><span class="s">"270"</span> <span class="na">height=</span><span class="s">"200"</span> <span class="na">id=</span><span class="s">"chatTextArea"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;mx:HBox&gt;</span>
      <span class="nt">&lt;mx:TextArea</span> <span class="na">width=</span><span class="s">"210"</span> <span class="na">height=</span><span class="s">"40"</span> <span class="na">id=</span><span class="s">"inputTextArea"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;mx:Button</span> <span class="na">id=</span><span class="s">"sendButton"</span> <span class="na">width=</span><span class="s">"50"</span> <span class="na">height=</span><span class="s">"40"</span> <span class="na">label=</span><span class="s">"Send"</span> <span class="na">click=</span><span class="s">"sendClick()"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/mx:HBox&gt;</span>
  <span class="nt">&lt;/mx:VBox&gt;</span>
<span class="nt">&lt;/mx:TitleWindow&gt;</span>
</code></pre></div></div>

<p><em>ChatMediator.as</em></p>

<p>There is something slightly different about this view compared to the Login or Roster views.  The chat windows are dynamically created when needed and thrown away when they are closed by the user so we can’t have a permanent view component as the <strong>viewComponent</strong> of <em>ChatMediator.as</em>.  Instead we’ll pass the top level *Application.mxml *component since this is what’s required in the arguments of <strong>PopupManager.addPopup</strong>.</p>

<div class="language-as3 highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
 Mediator - PureMVC
 */</span>
<span class="kr">package</span> <span class="nx">org</span><span class="p">.</span><span class="nx">davekeen</span><span class="p">.</span><span class="nx">xiffer</span><span class="p">.</span><span class="nx">view</span> <span class="p">{</span>
  <span class="kr">import</span> <span class="nx">flash</span><span class="p">.</span><span class="nx">display</span><span class="p">.</span><span class="nx">DisplayObject</span><span class="o">;</span>
  <span class="kr">import</span> <span class="nx">flash</span><span class="p">.</span><span class="nx">display</span><span class="p">.</span><span class="nx">DisplayObjectContainer</span><span class="o">;</span>
  <span class="kr">import</span> <span class="nx">flash</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">Event</span><span class="o">;</span>
  <span class="kr">import</span> <span class="nx">mx</span><span class="p">.</span><span class="nx">managers</span><span class="p">.</span><span class="nx">PopUpManager</span><span class="o">;</span>
  <span class="kr">import</span> <span class="nx">mx</span><span class="p">.</span><span class="nx">managers</span><span class="p">.</span><span class="nx">PopUpManagerChildList</span><span class="o">;</span>
  <span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">davekeen</span><span class="p">.</span><span class="nx">xiffer</span><span class="p">.</span><span class="nx">ApplicationFacade</span><span class="o">;</span>
  <span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">davekeen</span><span class="p">.</span><span class="nx">xiffer</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">ChatEvent</span><span class="o">;</span>
  <span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">jivesoftware</span><span class="p">.</span><span class="nx">xiff</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nx">JID</span><span class="o">;</span>
  <span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">jivesoftware</span><span class="p">.</span><span class="nx">xiff</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">Message</span><span class="o">;</span>
  <span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">puremvc</span><span class="p">.</span><span class="nx">as3</span><span class="p">.</span><span class="nx">interfaces</span><span class="p">.</span><span class="nx">INotification</span><span class="o">;</span>
  <span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">puremvc</span><span class="p">.</span><span class="nx">as3</span><span class="p">.</span><span class="nx">patterns</span><span class="p">.</span><span class="nx">mediator</span><span class="p">.</span><span class="nx">Mediator</span><span class="o">;</span>
  <span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">davekeen</span><span class="p">.</span><span class="nx">xiffer</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="o">*;</span>
  <span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">davekeen</span><span class="p">.</span><span class="nx">xiffer</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">components</span><span class="p">.</span><span class="nx">ChatView</span><span class="o">;</span>

  <span class="cm">/**
    * Chat Mediator - controls and stewards all popup chat windows
    */</span>
  <span class="kr">public</span> <span class="kr">class</span> <span class="nx">ChatMediator</span> <span class="kr">extends</span> <span class="nx">Mediator</span> <span class="kr">implements</span> <span class="nx">IMediator</span> <span class="p">{</span>

    <span class="c1">// Cannonical name of the Mediator</span>
    <span class="kr">public</span> <span class="kr">static</span> <span class="kr">const</span> <span class="nx">NAME</span><span class="o">:</span> <span class="nx">String</span> <span class="o">=</span> <span class="s2">"ChatMediator"</span><span class="o">;</span>

    <span class="cm">/**
      * An associative array of open ChatViews
      */</span>
    <span class="kr">private</span> <span class="kd">var</span> <span class="nx">chatViews</span><span class="o">:</span> <span class="nx">Array</span><span class="o">;</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">ChatMediator</span><span class="p">(</span><span class="nx">viewComponent</span><span class="o">:</span> <span class="nb">Object</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// pass the viewComponent to the superclass where </span>
      <span class="c1">// it will be stored in the inherited viewComponent property</span>
      <span class="kr">super</span><span class="p">(</span><span class="nx">NAME</span><span class="p">,</span> <span class="nx">viewComponent</span><span class="p">)</span><span class="o">;</span>

      <span class="nx">chatViews</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Array</span><span class="p">()</span><span class="o">;</span>
    <span class="p">}</span>

    <span class="cm">/**
      * Get the Mediator name.
      * &lt;P&gt;
      * Called by the framework to get the name of this
      * mediator. If there is only one instance, we may
      * define it in a constant and return it here. If
      * there are multiple instances, this method must
      * return the unique name of this instance.&lt;/P&gt;
      * 
      * @return String the Mediator name
      */</span>
    <span class="kr">override</span> <span class="kr">public</span> <span class="kd">function</span> <span class="nx">getMediatorName</span><span class="p">()</span><span class="o">:</span> <span class="nx">String</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">ChatMediator</span><span class="p">.</span><span class="nx">NAME</span><span class="o">;</span>
    <span class="p">}</span>

    <span class="cm">/**
      * List all notifications this Mediator is interested in.
      * &lt;P&gt;
      * Automatically called by the framework when the mediator
      * is registered with the view.&lt;/P&gt;
      * 
      * @return Array the list of Nofitication names
      */</span>
    <span class="kr">override</span> <span class="kr">public</span> <span class="kd">function</span> <span class="nx">listNotificationInterests</span><span class="p">()</span><span class="o">:</span> <span class="nx">Array</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">[</span>
        <span class="nx">ApplicationFacade</span><span class="p">.</span><span class="nx">OPEN_CHAT_WINDOW</span><span class="p">,</span>
        <span class="nx">ApplicationFacade</span><span class="p">.</span><span class="nx">RECEIVE_MESSAGE</span><span class="p">,</span>
        <span class="nx">ApplicationFacade</span><span class="p">.</span><span class="nx">VALID_LOGIN</span><span class="p">,</span>
        <span class="nx">ApplicationFacade</span><span class="p">.</span><span class="nx">DISCONNECT</span>
      <span class="p">]</span><span class="o">;</span>
    <span class="p">}</span>

    <span class="cm">/**
      * Handle all notifications this Mediator is interested in.
      * &lt;P&gt;
      * Called by the framework when a notification is sent that
      * this mediator expressed an interest in when registered
      * (see &lt;code&gt;listNotificationInterests&lt;/code&gt;.&lt;/P&gt;
      * 
      * @param INotification a notification 
      */</span>
    <span class="kr">override</span> <span class="kr">public</span> <span class="kd">function</span> <span class="nx">handleNotification</span><span class="p">(</span><span class="nx">note</span><span class="o">:</span> <span class="nx">INotification</span><span class="p">)</span><span class="o">:</span> <span class="nb">void</span> <span class="p">{</span>
      <span class="k">switch</span> <span class="p">(</span><span class="nx">note</span><span class="p">.</span><span class="nx">getName</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nx">ApplicationFacade</span><span class="p">.</span><span class="nx">OPEN_CHAT_WINDOW</span><span class="o">:</span>
          <span class="kd">var</span> <span class="nx">jid</span><span class="o">:</span> <span class="nx">JID</span> <span class="o">=</span> <span class="nx">note</span><span class="p">.</span><span class="nx">getBody</span><span class="p">()</span> <span class="nx">as</span> <span class="nx">JID</span><span class="o">;</span>
          <span class="nx">showChatWindow</span><span class="p">(</span><span class="nx">jid</span><span class="p">)</span><span class="o">;</span>
          <span class="k">break</span><span class="o">;</span>
        <span class="k">case</span> <span class="nx">ApplicationFacade</span><span class="p">.</span><span class="nx">RECEIVE_MESSAGE</span><span class="o">:</span>
          <span class="kd">var</span> <span class="nx">message</span><span class="o">:</span> <span class="nx">Message</span> <span class="o">=</span> <span class="nx">note</span><span class="p">.</span><span class="nx">getBody</span><span class="p">()</span> <span class="nx">as</span> <span class="nx">Message</span><span class="o">;</span>

          <span class="c1">// Add the message to the view</span>
          <span class="nx">chatViews</span><span class="p">[</span><span class="nx">message</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">toBareJID</span><span class="p">()].</span><span class="nx">addMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span><span class="o">;</span>
          <span class="k">break</span><span class="o">;</span>
        <span class="k">case</span> <span class="nx">ApplicationFacade</span><span class="p">.</span><span class="nx">VALID_LOGIN</span><span class="o">:</span>
          <span class="c1">// Enable all chat windows</span>
          <span class="k">for</span> <span class="nx">each</span><span class="p">(</span><span class="kd">var</span> <span class="nx">chatView</span><span class="o">:</span> <span class="nx">ChatView</span> <span class="k">in</span> <span class="nx">chatViews</span><span class="p">)</span>
          <span class="nx">chatView</span><span class="p">.</span><span class="nx">enabled</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>

          <span class="k">break</span><span class="o">;</span>
        <span class="k">case</span> <span class="nx">ApplicationFacade</span><span class="p">.</span><span class="nx">DISCONNECT</span><span class="o">:</span>
          <span class="c1">// Disable all chat windows</span>
          <span class="k">for</span> <span class="nx">each</span><span class="p">(</span><span class="nx">chatView</span> <span class="k">in</span> <span class="nx">chatViews</span><span class="p">)</span>
          <span class="nx">chatView</span><span class="p">.</span><span class="nx">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

          <span class="k">break</span><span class="o">;</span>
        <span class="k">default</span><span class="o">:</span>
          <span class="k">break</span><span class="o">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="cm">/**
      * Open up a chat window for this particular JID
      * 
      * @param    jid
      */</span>
    <span class="kr">private</span> <span class="kd">function</span> <span class="nx">showChatWindow</span><span class="p">(</span><span class="nx">jid</span><span class="o">:</span> <span class="nx">JID</span><span class="p">)</span><span class="o">:</span> <span class="nb">void</span> <span class="p">{</span>
      <span class="c1">// If the window exists already don't do anything</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">chatViews</span><span class="p">[</span><span class="nx">jid</span><span class="p">.</span><span class="nx">toBareJID</span><span class="p">()])</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">chatView</span><span class="o">:</span> <span class="nx">ChatView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ChatView</span><span class="p">()</span><span class="o">;</span>

        <span class="nx">PopUpManager</span><span class="p">.</span><span class="nx">addPopUp</span><span class="p">(</span><span class="nx">chatView</span><span class="p">,</span> <span class="nx">viewComponent</span> <span class="nx">as</span> <span class="nx">DisplayObjectContainer</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span><span class="o">;</span>
        <span class="nx">PopUpManager</span><span class="p">.</span><span class="nx">bringToFront</span><span class="p">(</span><span class="nx">chatView</span><span class="p">)</span><span class="o">;</span>
        <span class="nx">PopUpManager</span><span class="p">.</span><span class="nx">centerPopUp</span><span class="p">(</span><span class="nx">chatView</span><span class="p">)</span><span class="o">;</span>

        <span class="nx">chatView</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">Event</span><span class="p">.</span><span class="nx">CLOSE</span><span class="p">,</span> <span class="nx">onChatViewClose</span><span class="p">)</span><span class="o">;</span>
        <span class="nx">chatView</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">ChatEvent</span><span class="p">.</span><span class="nx">SEND_MESSAGE</span><span class="p">,</span> <span class="nx">onSendMessage</span><span class="p">)</span><span class="o">;</span>
        <span class="nx">chatView</span><span class="p">.</span><span class="nx">setJID</span><span class="p">(</span><span class="nx">jid</span><span class="p">)</span><span class="o">;</span>

        <span class="c1">// Add the chat view to the associative array</span>
        <span class="nx">chatViews</span><span class="p">[</span><span class="nx">jid</span><span class="p">.</span><span class="nx">toBareJID</span><span class="p">()]</span> <span class="o">=</span> <span class="nx">chatView</span><span class="o">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="cm">/**
      * The user has typed a message and sent it
      * 
      * @param    chatEvent
      */</span>
    <span class="kr">private</span> <span class="kd">function</span> <span class="nx">onSendMessage</span><span class="p">(</span><span class="nx">chatEvent</span><span class="o">:</span> <span class="nx">ChatEvent</span><span class="p">)</span><span class="o">:</span> <span class="nb">void</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">chatView</span><span class="o">:</span> <span class="nx">ChatView</span> <span class="o">=</span> <span class="nx">chatEvent</span><span class="p">.</span><span class="nx">currentTarget</span> <span class="nx">as</span> <span class="nx">ChatView</span><span class="o">;</span>

      <span class="c1">// Construct a XIFF message</span>
      <span class="kd">var</span> <span class="nx">message</span><span class="o">:</span> <span class="nx">Message</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Message</span><span class="p">(</span><span class="nx">chatEvent</span><span class="p">.</span><span class="nx">getJID</span><span class="p">(),</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">chatEvent</span><span class="p">.</span><span class="nx">getMessage</span><span class="p">(),</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">Message</span><span class="p">.</span><span class="nx">CHAT_TYPE</span><span class="p">)</span><span class="o">;</span>

      <span class="c1">// Echo it to our own view</span>
      <span class="nx">chatViews</span><span class="p">[</span><span class="nx">chatView</span><span class="p">.</span><span class="nx">getJID</span><span class="p">().</span><span class="nx">toBareJID</span><span class="p">()].</span><span class="nx">addMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span><span class="o">;</span>

      <span class="c1">// And send off a notification</span>
      <span class="nx">sendNotification</span><span class="p">(</span><span class="nx">ApplicationFacade</span><span class="p">.</span><span class="nx">SEND_MESSAGE</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span><span class="o">;</span>
    <span class="p">}</span>

    <span class="cm">/**
      * The chat window has been closed
      * 
      * @param    event
      */</span>
    <span class="kr">private</span> <span class="kd">function</span> <span class="nx">onChatViewClose</span><span class="p">(</span><span class="nx">event</span><span class="o">:</span> <span class="nx">Event</span><span class="p">)</span><span class="o">:</span> <span class="nb">void</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">chatView</span><span class="o">:</span> <span class="nx">ChatView</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span> <span class="nx">as</span> <span class="nx">ChatView</span><span class="o">;</span>
      <span class="nx">chatView</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">Event</span><span class="p">.</span><span class="nx">CLOSE</span><span class="p">,</span> <span class="nx">onChatViewClose</span><span class="p">)</span><span class="o">;</span>
      <span class="nx">PopUpManager</span><span class="p">.</span><span class="nx">removePopUp</span><span class="p">(</span><span class="nx">chatView</span><span class="p">)</span><span class="o">;</span>

      <span class="c1">// Delete the chat view from the associative array</span>
      <span class="k">delete</span> <span class="nx">chatViews</span><span class="p">[</span><span class="nx">chatView</span><span class="p">.</span><span class="nx">getJID</span><span class="p">().</span><span class="nx">toBareJID</span><span class="p">()]</span><span class="o">;</span>
    <span class="p">}</span>

  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><em>SendMessageCommand.as</em></p>

<div class="language-as3 highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Simple Command - PureMVC
 */</span>
<span class="kr">package</span> <span class="nx">org</span><span class="p">.</span><span class="nx">davekeen</span><span class="p">.</span><span class="nx">xiffer</span><span class="p">.</span><span class="nx">controller</span> <span class="p">{</span>
  <span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">davekeen</span><span class="p">.</span><span class="nx">xiffer</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">ChatEvent</span><span class="o">;</span>
  <span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">davekeen</span><span class="p">.</span><span class="nx">xiffer</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">XMPPProxy</span><span class="o">;</span>
  <span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">jivesoftware</span><span class="p">.</span><span class="nx">xiff</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">Message</span><span class="o">;</span>
  <span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">puremvc</span><span class="p">.</span><span class="nx">as3</span><span class="p">.</span><span class="nx">interfaces</span><span class="p">.</span><span class="nx">INotification</span><span class="o">;</span>
  <span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">puremvc</span><span class="p">.</span><span class="nx">as3</span><span class="p">.</span><span class="nx">patterns</span><span class="p">.</span><span class="nx">command</span><span class="p">.</span><span class="nx">SimpleCommand</span><span class="o">;</span>
  <span class="kr">import</span> <span class="nx">org</span><span class="p">.</span><span class="nx">puremvc</span><span class="p">.</span><span class="nx">as3</span><span class="p">.</span><span class="nx">patterns</span><span class="p">.</span><span class="nx">observer</span><span class="p">.</span><span class="nx">Notification</span><span class="o">;</span>

  <span class="cm">/**
   * Send a message to the proxy
   */</span>
  <span class="kr">public</span> <span class="kr">class</span> <span class="nx">SendMessageCommand</span> <span class="kr">extends</span> <span class="nx">SimpleCommand</span> <span class="p">{</span>

    <span class="kr">override</span> <span class="kr">public</span> <span class="kd">function</span> <span class="nx">execute</span><span class="p">(</span><span class="nx">note</span><span class="o">:</span><span class="nx">INotification</span><span class="p">)</span><span class="o">:</span><span class="nb">void</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">message</span><span class="o">:</span><span class="nx">Message</span> <span class="o">=</span> <span class="nx">note</span><span class="p">.</span><span class="nx">getBody</span><span class="p">()</span> <span class="nx">as</span> <span class="nx">Message</span><span class="o">;</span>
      <span class="kd">var</span> <span class="nx">xmppProxy</span><span class="o">:</span><span class="nx">XMPPProxy</span> <span class="o">=</span> <span class="nx">facade</span><span class="p">.</span><span class="nx">retrieveProxy</span><span class="p">(</span><span class="nx">XMPPProxy</span><span class="p">.</span><span class="nx">NAME</span><span class="p">)</span> <span class="nx">as</span> <span class="nx">XMPPProxy</span><span class="o">;</span>

      <span class="c1">// Send the message</span>
      <span class="nx">xmppProxy</span><span class="p">.</span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span><span class="o">;</span>
    <span class="p">}</span>

  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And there it is!  A working Jabber, Flex and PureMVC application of your very own.</p>

<p>Let’s wrap it all up with a <a href="/puremvc-tutorial-flex-puremvc-jabber-and-xiff-3-conclusion-demo-downloads/">conclusion, a working demo and the full source code.</a></p>

</article>
</div>

  </body>

  <script src="https://unpkg.com/smartphoto@1.1.0/js/smartphoto.min.js"></script>
  <script src="https://unpkg.com/flickity@2/dist/flickity.pkgd.min.js"></script>
</html>
